---
phase: 06-schema-migration
plan: 02
type: execute
wave: 2
depends_on: [06-01]
files_modified: []
autonomous: false
requirements: [MEET-03, MEET-05, SCOPE-03]

must_haves:
  truths:
    - "The migration SQL has been executed on the production Supabase database"
    - "The meetings table exists with the Fellesmøte #1 row in completed status"
    - "All stations and groups have a non-null meeting_id pointing to Fellesmøte #1"
    - "The app boots and functions identically to before the migration with no user-visible regressions"
    - "Real-time chat works: messages sent in a station appear for all group members"
  artifacts: []
  key_links:
    - from: "supabase/migrations/020_meetings_migration.sql"
      to: "Supabase production database"
      via: "Manual copy-paste into Dashboard SQL Editor"
      pattern: "Human applies migration"
---

<objective>
Apply the migration to the Supabase database and verify the app works identically to v1.0 with no regressions.

Purpose: The migration SQL from Plan 01 must be manually applied because the project uses the Supabase Dashboard SQL Editor (no linked Supabase CLI). After application, the entire app must be smoke-tested to confirm zero regressions.

Output: A working database with the multi-meeting schema, verified by human testing.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-schema-migration/06-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Apply migration SQL to Supabase</name>
  <files>supabase/migrations/020_meetings_migration.sql</files>
  <action>
Copy the entire contents of `supabase/migrations/020_meetings_migration.sql` and execute it in the Supabase Dashboard SQL Editor.

Steps:
1. Open the Supabase Dashboard for your project
2. Navigate to SQL Editor (left sidebar)
3. Create a new query
4. Copy the ENTIRE contents of `supabase/migrations/020_meetings_migration.sql` and paste into the editor
5. Click "Run" to execute the migration
6. Verify the output shows "Success" with no errors
7. Navigate to Table Editor and confirm:
   - A `meetings` table exists with 1 row (Fellesmøte #1, status: completed)
   - The `stations` table has a `meeting_id` column (all rows filled)
   - The `groups` table has a `meeting_id` column (all rows filled)
   - The `meeting_status` table no longer exists
  </action>
  <verify>User confirms migration executed successfully in Supabase Dashboard SQL Editor with no errors</verify>
  <done>Migration applied: meetings table exists with 1 row, stations/groups have meeting_id column, meeting_status table dropped</done>
  <resume-signal>Type "applied" once the migration ran successfully, or describe any errors</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify app works with no regressions</name>
  <files>supabase/migrations/020_meetings_migration.sql</files>
  <action>
The database schema has been migrated to support multiple meetings. All v1.0 data is preserved under "Fellesmøte #1". No app code was changed — the app should function identically. Verify by testing:

1. Open the app in your mobile browser (or dev tools mobile view)
2. **Login test:** Log in with a regular user account — you should see the dashboard with your group and stations
3. **Station selector test:** Station cards should show with correct titles and status (available/active/completed from previous sessions)
4. **Chat test (if an active or completed station exists):** Open a station and verify:
   - Previous messages are visible
   - If station is active: you can send a new message and it appears in real-time
   - If station is completed: it opens in read-only mode
5. **Admin test:** Log in as admin and verify:
   - Admin panel loads correctly
   - User list shows all users
   - Group page shows existing groups
   - Export downloads a Markdown file with previous discussions
   - Word cloud page loads with existing message data
6. **No errors:** Check browser console for any new errors (especially Supabase/Realtime errors)
  </action>
  <verify>User confirms all app functions work identically to before migration with zero regressions</verify>
  <done>App verified: login works, stations load, chat works (messages visible, real-time functional), admin panel/export/word cloud all functional, no console errors</done>
  <resume-signal>Type "approved" if everything works, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Migration applied successfully (no SQL errors)
2. meetings table has exactly 1 row: "Fellesmøte #1", status "completed", date "2026-02-19"
3. All stations.meeting_id and groups.meeting_id are non-null
4. meeting_status table no longer exists
5. App login works for both regular users and admin
6. Station selector shows correct status
7. Chat messages load and (if active) real-time works
8. Admin panel, export, and word cloud function correctly
9. No new errors in browser console
</verification>

<success_criteria>
- The migration was applied without errors
- The app boots and functions identically to before
- Real-time chat continues to work (Realtime RLS policy unaffected)
- Admin features (export, word cloud, groups, users) all work
- Zero user-visible regressions
</success_criteria>

<output>
After completion, create `.planning/phases/06-schema-migration/06-02-SUMMARY.md`
</output>
