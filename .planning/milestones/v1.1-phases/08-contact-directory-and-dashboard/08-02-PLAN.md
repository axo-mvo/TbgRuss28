# Plan 08-02: Contact Directory Components

---
wave: 1
depends_on: []
files_modified:
  - src/components/dashboard/ContactDirectory.tsx
  - src/components/dashboard/YouthDirectoryView.tsx
  - src/components/dashboard/EveryoneDirectoryView.tsx
  - src/components/dashboard/ContactActions.tsx
requirements:
  - DIR-01
  - DIR-02
  - DIR-03
  - DIR-04
autonomous: true
---

## Goal

Build the searchable contact directory as a set of client components that display all members with two views (youth-centered and flat everyone), search filtering, and tap-to-call/tap-to-email action links. These components receive data as props from the server component (dashboard page) and handle all filtering client-side.

## must_haves

- [ ] `ContactDirectory` is a `'use client'` component with a `SearchInput`, a two-button view toggle (Ungdommer / Alle), and renders the active view
- [ ] Youth-centered view (`YouthDirectoryView`): each youth row is expandable (using `<details>`) to reveal linked parents with their name, phone, and email as tappable action links
- [ ] Everyone view (`EveryoneDirectoryView`): flat alphabetical list of all members showing name, role badge, phone, and email as tappable action links
- [ ] `ContactActions` renders `tel:+47{phone}` and `mailto:{email}` links with 44px minimum touch targets, gracefully handling null phone
- [ ] Search filters both views by name (case-insensitive, client-side `.toLowerCase().includes()`)

## Context for Executor

### Existing patterns to reuse
- `SearchInput` component: `src/components/ui/SearchInput.tsx` -- takes `value`, `onChange`, `placeholder` props. Reuse directly.
- `Badge` component: `src/components/ui/Badge.tsx` -- has `youth`, `parent`, `admin` variants. Use for role badges.
- `EmptyState` component: `src/components/ui/EmptyState.tsx` -- use when search returns no results
- `RegisteredUsersOverview`: `src/components/dashboard/RegisteredUsersOverview.tsx` -- the youth-expand-to-parents `<details>` pattern is the base for `YouthDirectoryView`. This component will be REPLACED (not used alongside) by `ContactDirectory` in plan 08-03.

### Data shapes (passed as props from server)
```typescript
// Youth with their linked parents (for youth-centered view)
interface YouthWithParents {
  id: string
  full_name: string
  phone: string | null
  email: string
  parents: Array<{
    id: string
    full_name: string
    phone: string | null
    email: string
  }>
}

// All members (for everyone view)
interface Member {
  id: string
  full_name: string
  role: 'youth' | 'parent' | 'admin'
  phone: string | null
  email: string
}
```

### Design guidelines
- **Mobile first**: all touch targets minimum 44px (`min-h-[44px]`)
- **No new fonts**: use the existing font stack from globals.css
- **Colors**: `teal-primary` (#1B4D5C) for active tab/accent, `text-primary` (#1E2D3D) for names, `text-muted` (#3A4F5E) for secondary text, `coral` for parent badges
- **Tab toggle**: two-button segmented control with `rounded-lg border border-gray-200 overflow-hidden`. Active button: `bg-teal-primary text-white`. Inactive: `bg-white text-text-muted hover:bg-gray-50`.
- **Search placeholder**: `"Søk etter navn..."` (Norwegian)
- **Empty search**: show `EmptyState` with title `"Ingen treff"` and description `"Prøv et annet søk."`
- **Phone display**: raw 8-digit number in the visible text; `tel:+47{phone}` in the href
- **Null phone**: omit the phone link entirely; only show email link
- **Icons**: use inline SVG for phone and email icons (not emoji, not external icon library). Small icons (h-4 w-4) next to the contact text.

### Phone icon SVG
```html
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
    d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
</svg>
```

### Email icon SVG
```html
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
</svg>
```

### Anti-patterns to avoid
- Do NOT fetch data inside these components -- all data arrives as props
- Do NOT make server action calls per search keystroke -- filter client-side only
- Do NOT use `cursor-pointer` on non-interactive elements
- Do NOT use emojis as icons

<tasks>
<task id="08-02-01" title="Build ContactActions and directory view components">
**Files to create:**
- `src/components/dashboard/ContactActions.tsx`
- `src/components/dashboard/YouthDirectoryView.tsx`
- `src/components/dashboard/EveryoneDirectoryView.tsx`

**ContactActions.tsx:**
1. NOT a client component (no state needed -- just renders links)
2. Props: `{ phone: string | null; email: string }`
3. Render a `flex gap-2 mt-1` container
4. If phone is not null: render `<a href="tel:+47{phone}">` with phone icon SVG (h-4 w-4) and the 8-digit phone number text. Style: `inline-flex items-center gap-1.5 min-h-[44px] px-2 text-sm text-teal-primary hover:text-teal-secondary transition-colors`
5. Always render `<a href="mailto:{email}">` with email icon SVG and the email text. Same style as phone link.
6. Both links: add `aria-label` attributes ("Ring {phone}" and "Send e-post til {email}")

**YouthDirectoryView.tsx:**
1. NOT a client component (receives filtered data as props)
2. Props: `{ youth: YouthWithParents[]; search: string }` (search is for highlighting or filtering, but filtering should be done by parent component; this just renders)
3. Actually, simplify: Props are `{ youth: YouthWithParents[] }` -- the parent ContactDirectory handles filtering before passing data
4. If `youth.length === 0`: render `EmptyState` with title "Ingen treff" and description "Prøv et annet søk."
5. Render a `space-y-2` container with one `<details>` per youth (same expand pattern as `RegisteredUsersOverview`)
6. Summary row: youth name (font-medium), Badge variant="parent" showing parent count ("{N} forelder/foreldre"), chevron icon that rotates on open
7. Expanded content: for each parent, show parent name (text-sm text-text-muted) + `ContactActions` with parent's phone and email
8. ALSO show `ContactActions` for the youth themselves in the summary row area (below the name, visible without expanding)

**EveryoneDirectoryView.tsx:**
1. NOT a client component
2. Props: `{ members: Member[] }`
3. If `members.length === 0`: render `EmptyState` with title "Ingen treff" and description "Prøv et annet søk."
4. Render a `space-y-2` container with one card per member
5. Each card: `p-3 rounded-lg border border-gray-200 bg-white`
6. Top line: full_name (font-medium text-text-primary) + `Badge` showing role (variant matches role)
7. Below name: `ContactActions` with phone and email

**Verification:**
- All components render correctly with the defined data shapes
- Touch targets are 44px minimum on all interactive elements
- Null phone is gracefully handled (no broken link)
- TypeScript compiles without errors
</task>

<task id="08-02-02" title="Build ContactDirectory wrapper with search and tab toggle">
**File to create:**
- `src/components/dashboard/ContactDirectory.tsx`

**Implementation:**
1. `'use client'` directive (manages search state and view toggle)
2. Import `SearchInput` from `@/components/ui/SearchInput`
3. Import `YouthDirectoryView` and `EveryoneDirectoryView`
4. Props interface:
```typescript
interface ContactDirectoryProps {
  youth: YouthWithParents[]
  everyone: Member[]
}
```
5. State: `search` (string, default ''), `view` ('youth' | 'everyone', default 'youth')
6. Filtering logic:
   - `normalizedSearch = search.toLowerCase().trim()`
   - Youth view filter: keep youth whose `full_name` includes search OR any of their parents' `full_name` includes search
   - Everyone view filter: keep members whose `full_name` includes search
7. Render structure:
   ```
   <section>
     <h2>Kontaktliste</h2>      <!-- text-lg font-semibold text-text-primary mb-4 -->
     <SearchInput />              <!-- mb-3, placeholder="Søk etter navn..." -->
     <TabToggle />                <!-- mb-4, two-button segmented control -->
     {view === 'youth' ? <YouthDirectoryView /> : <EveryoneDirectoryView />}
   </section>
   ```
8. Tab toggle: two buttons inside a `flex rounded-lg border border-gray-200 overflow-hidden` container
   - "Ungdommer" button (sets view to 'youth')
   - "Alle" button (sets view to 'everyone')
   - Active: `bg-teal-primary text-white`
   - Inactive: `bg-white text-text-muted hover:bg-gray-50`
   - Both: `flex-1 min-h-[44px] text-sm font-medium transition-colors`

**Verification:**
- Search filters results in real-time for both views
- Tab toggle switches between youth and everyone view
- Empty search shows EmptyState
- TypeScript compiles without errors
</task>
</tasks>

## Verification Criteria

1. **DIR-01**: ContactDirectory is a searchable component ready to be placed on the dashboard
2. **DIR-02**: Youth view expands to show linked parents with contact info
3. **DIR-03**: Everyone view shows all members alphabetically with search
4. **DIR-04**: Phone and email are tappable action links with 44px touch targets
5. **Mobile-first**: All components work well on 375px width screens
6. **No data fetching**: Components receive all data as props -- zero Supabase calls inside
