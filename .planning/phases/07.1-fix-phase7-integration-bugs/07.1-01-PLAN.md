---
phase: 07.1-fix-phase7-integration-bugs
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/admin/StationList.tsx
  - src/lib/actions/admin.ts
  - src/app/admin/groups/page.tsx
  - src/app/admin/wordcloud/page.tsx
autonomous: true
requirements: [SCOPE-01]

must_haves:
  truths:
    - "reorderStations errors in onDragEnd are caught and displayed to the user via the existing error banner"
    - "The orphaned /admin/groups route is removed — navigating to it returns a 404"
    - "The orphaned /admin/wordcloud route is removed — navigating to it returns a 404"
    - "revalidatePath fallbacks in admin.ts point to /admin/meetings instead of the deleted /admin/groups path"
    - "TypeScript compiles cleanly with no new errors"
  artifacts:
    - path: "src/components/admin/StationList.tsx"
      provides: "onDragEnd callback chains .then()/.catch() on reorderStations to surface errors"
    - path: "src/lib/actions/admin.ts"
      provides: "revalidatePath fallback changed from /admin/groups to /admin/meetings"
  key_links:
    - from: "src/components/admin/StationList.tsx"
      to: "src/lib/actions/meeting.ts"
      via: "reorderStations(meetingId, orderedIds) with .then()/.catch() error handling"
      pattern: "reorderStations.*\\.then"
---

<objective>
Fix the unawaited reorderStations call in StationList's onDragEnd handler so server errors are caught and displayed, remove the orphaned /admin/groups and /admin/wordcloud route files that are dead-end pages superseded by meeting detail tabs, and clean up stale revalidatePath fallbacks in admin.ts.

Purpose: Close integration gaps identified in the v1.1 milestone audit — improve reliability (silent errors) and remove confusing dead-end routes. Research confirmed the Supabase query builder mutation bugs are false positives; only these three fixes are needed.
Output: StationList surfaces reorder errors, orphaned routes return 404, admin actions revalidate the correct paths.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.1-fix-phase7-integration-bugs/07.1-RESEARCH.md

@src/components/admin/StationList.tsx
@src/lib/actions/admin.ts
@src/app/admin/groups/page.tsx
@src/app/admin/wordcloud/page.tsx

<interfaces>
<!-- Key types and contracts from existing codebase. -->

From src/lib/actions/meeting.ts (reorderStations return type):
```typescript
export async function reorderStations(
  meetingId: string,
  orderedStationIds: string[]
): Promise<{ error?: string }>
```

From src/components/admin/StationList.tsx (existing state for error display):
```typescript
const [error, setError] = useState<string | null>(null)
```
The component already has an error banner that renders when `error` is non-null. The onDragEnd callback has access to `setError` via closure.

From src/lib/actions/admin.ts (revalidatePath pattern, 4 occurrences):
```typescript
revalidatePath(meetingId ? `/admin/meetings/${meetingId}` : '/admin/groups')
```
The `/admin/groups` fallback is dead code since meetingId is always provided from the meeting detail page. Changing the fallback to `/admin/meetings` is a safe defensive cleanup.
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix unawaited reorderStations and clean up revalidatePath fallbacks</name>
  <files>src/components/admin/StationList.tsx, src/lib/actions/admin.ts</files>
  <action>
**Modify `src/components/admin/StationList.tsx`** — surface errors from reorderStations in onDragEnd:

1. In the `onDragEnd` callback (around line 331-335), change the fire-and-forget `reorderStations(meeting.id, orderedIds)` call to chain `.then()/.catch()` for error handling:

```typescript
// BEFORE:
onDragEnd={() => {
  const orderedIds = stations.map((s) => s.id)
  reorderStations(meeting.id, orderedIds)
}}

// AFTER:
onDragEnd={() => {
  const orderedIds = stations.map((s) => s.id)
  reorderStations(meeting.id, orderedIds)
    .then((result) => {
      if (result.error) {
        setError(result.error)
      }
    })
    .catch(() => {
      setError('Kunne ikke endre rekkefølgen')
    })
}}
```

**Why `.then()/.catch()` instead of `async/await`:** The `onDragEnd` callback type in `@dnd-kit/react` is `(event) => void`, not `(event) => Promise<void>`. Using promise chaining avoids type conflicts while still handling errors. The existing `error` state and error banner are already in the component — no new UI needed.

**Modify `src/lib/actions/admin.ts`** — update stale revalidatePath fallbacks:

2. In the four `revalidatePath` calls that reference `/admin/groups` as a fallback (lines 154, 176, 235, 262), change the fallback from `'/admin/groups'` to `'/admin/meetings'`:

```typescript
// BEFORE (4 occurrences):
revalidatePath(meetingId ? `/admin/meetings/${meetingId}` : '/admin/groups')

// AFTER (4 occurrences):
revalidatePath(meetingId ? `/admin/meetings/${meetingId}` : '/admin/meetings')
```

This is a defensive cleanup — meetingId is always provided when called from the meeting detail page, so the fallback is dead code. But if it ever triggers, `/admin/meetings` is the correct page to revalidate (the meetings list), not the deleted `/admin/groups` route.
  </action>
  <verify>
    <automated>cd /Users/mariusvalle-olsen/Github/TbgRuss28 && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
- reorderStations errors in onDragEnd are caught via .then()/.catch() and displayed via the existing error banner
- revalidatePath fallbacks updated from '/admin/groups' to '/admin/meetings' in all 4 occurrences
- TypeScript compiles cleanly
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove orphaned /admin/groups and /admin/wordcloud route files</name>
  <files>src/app/admin/groups/page.tsx, src/app/admin/wordcloud/page.tsx</files>
  <action>
**Delete `src/app/admin/groups/page.tsx`:**

This page was the v1.0 global groups page. It was superseded in Phase 7 by the per-meeting Grupper tab inside `/admin/meetings/[id]`. The page shows all groups across all meetings (confusing and incorrect in a multi-meeting context). It is not linked from the admin hub anymore. Delete the file. Next.js will automatically return 404 for this route.

After deleting the page file, also delete the parent directory if it becomes empty:
- Delete `src/app/admin/groups/` directory

**Delete `src/app/admin/wordcloud/page.tsx`:**

This page was the v1.0 global word cloud page. It was superseded in Phase 7 by the per-meeting Resultat tab inside `/admin/meetings/[id]`. The page shows messages across all meetings (confusing and incorrect in a multi-meeting context). It is not linked from the admin hub anymore. Delete the file. Next.js will automatically return 404 for this route.

After deleting the page file, also delete the parent directory if it becomes empty:
- Delete `src/app/admin/wordcloud/` directory

**No redirects needed.** Research confirmed no external links exist to these routes — they were only ever linked from the admin hub, which was updated in Phase 7 to link to meeting detail pages instead. If the admin has bookmarked these URLs, `next.config.ts` redirects can be added later on demand.
  </action>
  <verify>
    <automated>cd /Users/mariusvalle-olsen/Github/TbgRuss28 && test ! -f src/app/admin/groups/page.tsx && test ! -f src/app/admin/wordcloud/page.tsx && echo "PASS: orphaned routes deleted" || echo "FAIL: files still exist"</automated>
    <automated>cd /Users/mariusvalle-olsen/Github/TbgRuss28 && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
- src/app/admin/groups/page.tsx deleted (and parent directory if empty)
- src/app/admin/wordcloud/page.tsx deleted (and parent directory if empty)
- Navigating to /admin/groups returns 404
- Navigating to /admin/wordcloud returns 404
- No import references to these deleted files remain
- TypeScript compiles cleanly
  </done>
</task>

</tasks>

<verification>
1. Navigate to a meeting detail page -> Stasjoner tab -> drag a station to reorder -> verify no console errors, order persists on page reload
2. Temporarily break reorderStations (e.g., pass invalid meetingId) -> drag to reorder -> verify error banner appears with Norwegian error message
3. Navigate to /admin/groups directly -> should see Next.js 404 page
4. Navigate to /admin/wordcloud directly -> should see Next.js 404 page
5. Navigate to meeting detail -> Grupper tab -> create/delete groups -> verify revalidation works correctly (page updates without stale data)
6. TypeScript compiles with no errors: `npx tsc --noEmit`
7. Dev server runs without warnings about missing routes or broken imports
</verification>

<success_criteria>
- reorderStations errors are surfaced to the user in the existing error banner (not silently swallowed)
- Orphaned /admin/groups and /admin/wordcloud routes return 404
- revalidatePath fallbacks point to /admin/meetings (not deleted /admin/groups)
- No Supabase query builder changes — research confirmed .eq() mutates in place (false positive)
- All Norwegian labels preserved
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-fix-phase7-integration-bugs/07.1-01-SUMMARY.md`
</output>
